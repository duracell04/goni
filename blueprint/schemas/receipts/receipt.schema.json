{
    "$schema":  "https://json-schema.org/draft/2020-12/schema",
    "title":  "Receipt",
    "type":  "object",
    "required":  [
                     "receipt_id",
                     "timestamp",
                     "trace_id",
                     "span_id",
                     "actor_id",
                     "action_type",
                     "capability_id",
                     "policy_decision",
                     "decision_basis",
                     "budget_delta",
                     "input_hash",
                     "output_hash",
                     "memory_diff_refs"
                 ],
    "properties":  {
                       "receipt_id":  {
                                          "type":  "string"
                                      },
                       "timestamp":  {
                                         "type":  "string",
                                         "format":  "date-time"
                                     },
                       "trace_id":  {
                                        "type":  "string"
                                    },
                       "span_id":  {
                                       "type":  "string"
                                   },
                       "actor_id":  {
                                        "type":  "string"
                                    },
                       "action_type":  {
                                           "type":  "string"
                                       },
                       "capability_id":  {
                                             "type":  "string"
                                         },
                       "policy_decision":  {
                                               "type":  "string"
                                           },
                       "decision_basis":  {
                                              "type":  "object",
                                              "properties":  {
                                                                 "policy_hash":  {
                                                                                     "type":  "string"
                                                                                 },
                                                                 "rule_ids":  {
                                                                                  "type":  "array",
                                                                                  "items":  {
                                                                                                "type":  "string"
                                                                                            }
                                                                              },
                                                                 "approval_refs":  {
                                                                                       "type":  "array",
                                                                                       "items":  {
                                                                                                     "type":  "string"
                                                                                                 }
                                                                                   }
                                                             },
                                              "additionalProperties":  true
                                          },
                       "budget_delta":  {
                                            "type":  "object",
                                            "additionalProperties":  {
                                                                         "type":  "number"
                                                                     }
                                        },
                       "input_hash":  {
                                          "type":  "string"
                                      },
                       "output_hash":  {
                                           "type":  "string"
                                       },
                       "memory_diff_refs":  {
                                                "type":  "array",
                                                "items":  {
                                                              "type":  "string"
                                                          }
                                            },
                       "execution_id":  {
                                            "type":  "string"
                                        },
                       "parent_execution_id":  {
                                                   "type":  "string"
                                               },
                       "execution_type":  {
                                              "type":  "string",
                                              "enum":  [
                                                           "action",
                                                           "tool",
                                                           "model"
                                                       ]
                                          },
                       "provider":  {
                                        "type":  "string"
                                    },
                       "model_id":  {
                                        "type":  "string"
                                    },
                       "metering":  {
                                        "type":  "object",
                                        "properties":  {
                                                           "tokens_in":  {
                                                                             "type":  "integer",
                                                                             "minimum":  0
                                                                         },
                                                           "tokens_out":  {
                                                                              "type":  "integer",
                                                                              "minimum":  0
                                                                          },
                                                           "latency_ms":  {
                                                                              "type":  "integer",
                                                                              "minimum":  0
                                                                          },
                                                           "tool_calls":  {
                                                                              "type":  "integer",
                                                                              "minimum":  0
                                                                          },
                                                           "bytes_egress":  {
                                                                                "type":  "integer",
                                                                                "minimum":  0
                                                                            },
                                                           "ram_peak_bytes":  {
                                                                                  "type":  "integer",
                                                                                  "minimum":  0
                                                                              }
                                                       },
                                        "additionalProperties":  false
                                    },
                       "budget_spent":  {
                                            "type":  "object",
                                            "additionalProperties":  {
                                                                         "type":  "number"
                                                                     }
                                        },
                       "egress":  {
                                      "type":  "array",
                                      "items":  {
                                                    "type":  "object",
                                                    "properties":  {
                                                                       "destination":  {
                                                                                           "type":  "string"
                                                                                       },
                                                                       "bytes_out":  {
                                                                                         "type":  "integer",
                                                                                         "minimum":  0
                                                                                     },
                                                                       "reason":  {
                                                                                      "type":  "string"
                                                                                  }
                                                                   },
                                                    "required":  [
                                                                     "destination"
                                                                 ],
                                                    "additionalProperties":  false
                                                }
                                  },
                       "source_refs":  {
                                           "type":  "array",
                                           "items":  {
                                                         "type":  "string"
                                                     }
                                       },
                       "approval_id":  {
                                           "type":  "string"
                                       },
                       "redaction_profile":  {
                                                 "type":  "string"
                                             }
                   },
    "additionalProperties":  true
}
